[Raul Ikeda Gomes da Silva](http://lattes.cnpq.br/5935139039430914). Functional Programming. [Insper](https://github.com/Insper), 2025.

# Wallet Tunning

> [!CAUTION]
> This repository is **not intended for investment advice**. The author takes **no responsibility** for any consequences of decisions based on the results generated by this application. Use at your own risk!

A delightful, high-performance Haskell app for portfolio optimization using Modern Portfolio Theory (MPT).

## Features
- **Randomized portfolio optimization**: Finds the optimal wallet by generating random asset weights and maximizing the Sharpe Ratio.
- **Blazing fast**: Binds to low-level BLAS and LAPACK linear algebra libraries for maximum performance.
- **Rich data**: Includes tickers for both the US30 and S&P500 indexes out of the box.
- **Open data fetching**: Python script fetches historical prices from Yahoo Finance (via `yfinance`).
- **Heuristic search**: Uses randomization-based optimization to explore the space of possible portfolios.

## How it works
- Selects all subsets of assets from a tickers list. Eg.: 25 assets out of US30, which takes 142.506 possible combinations.
- Generates a bunch of random portfolios (wallets) with constraints:
  - No asset has zero weight
  - No asset exceeds 20% of the portfolio
  - All weights sum to 100%
- Evaluates each wallet's Sharpe Ratio using historical price data.
- Reports the best wallet found.

## Getting started

### 1. Fetch price data

Set up a little python environment for data pulling:

```sh
sudo apk add py3-pip
python3 -m venv .venv
source .venv/bin/activate
pip install yfinance
```

- Add a list of sstock tickers to the `data/index/` folder.
- Edit the `data/pull.sh` script to select your tickers list and set the time range.
- You can run the script or the `data/download.py` directly for custom ranges or tickers.
- This will download historical prices for all tickers into `data/prices/`.

```sh
./data/pull.sh
```

### 2. Build and run the app

```sh
stack setup
stack run
```

> [!NOTE]
> For large datasets, this might take a while....

## Project structure
- `data/` — Data scripts, tickers, and price files
  - `index/SP500-tickers.txt` — S&P500 tickers
  - `index/US30-tickers.txt` — US30 tickers
  - `download.py` — Python script to fetch prices from Yahoo Finance
  - `pull.sh` — Bash script to fetch all tickers in bulk
- `app/Main.hs` — Main entry point, you can edit it to set your index list, subset size and number of random tries per combination
- `src/` — Haskell source code (portfolio logic, optimization, etc.)

## Performance
- Uses Haskell's `hmatrix` for linear algebra, binding to BLAS/LAPACK for speed.
- Parallelized computations for fast portfolio evaluation.

## Example Results

- Index: US30
- Subset: 25 out of all 30
- Iterations: 142.506.000
- Elapsed time: 600 seconds
- Sharpe Ratio: 0.00014

| Ticker | Weight (%) |
|:-------|-----------:|
| `AAPL` |       4.23 |
| `AMGN` |       0.10 |
| `AXP`  |       1.74 |
| `BA`   |       0.10 |
| `CAT`  |       0.10 |
| `CRM`  |       0.10 |
| `CSCO` |      14.08 |
| `CVX`  |       0.11 |
| `DIS`  |       0.10 |
| `DOW`  |       0.10 |
| `HD`   |       0.00 |
| `HON`  |       0.13 |
| `JNJ`  |      15.02 |
| `JPM`  |       0.10 |
| `KO`   |       0.69 |
| `MCD`  |       0.15 |
| `MMM`  |      11.11 |
| `MRK`  |       0.11 |
| `MSFT` |       0.10 |
| `NKE`  |      19.56 |
| `PG`   |       0.10 |
| `TRV`  |       0.10 |
| `UNH`  |       0.19 |
| `VZ`   |      13.11 |
| `WMT`  |      18.77 |

### Setup Specifications
- **Processor**: Intel® Core™ Ultra 7 155U - 14 × 4.8 GHz
- **Memory**: 16 GB of RAM
- **Host OS**: Ubuntu 22.04.5 LTS on kernel v6.8
- **Container OS**: Alpine Linux v3.20

> [!NOTE]
> Results and performance will vary depending on your hardware and the number of combinations/iterations chosen.

## LICENSE

This project is [MIT Licensed](LICENSE)!
